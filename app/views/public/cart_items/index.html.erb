<div class="row">
  <div class="col-md-10 mx-auto">
    <h3 class="my-3">ショッピングカート</h3>
    <div>
    </div>
    <table class='table table-inverse'>
      <thead>
        <tr>
          <th>商品名</th>
          <th>単価(税込)</th>
          <th>数量</th>
          <th>小計</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% total_price = 0 %> <%# 合計金額を計算するための変数を初期化 %>      
        <% @cart_items.each do |cart_item| %>
          <tr>
            <td>
              <div class="row">
                <p><%= cart_item.item.name %></p>
              </div>
            </td>
            <td>
              <%= cart_item.item.add_tax_price %>
            </td>
            <td>
              <%= form_with model: cart_item, url: cart_item_path(cart_item), method: :patch, local: true do |f| %>
                <%= f.number_field :amount, value: cart_item.amount, min: 1, class: 'form-control d-inline-block', style: 'width: 80px;' %>
                <%= f.submit "変更", class: 'btn btn-success btn-sm ml-2' %>
              <% end %>
            </td>
            <td>
              <%= cart_item.subtotal %>
            </td>
            <td>
              <%= link_to "削除する", cart_item_path(cart_item), method: :delete, data: { confirm: '本当に削除しますか？' }, class: 'btn btn-danger' %>
            </td>
          </tr>
          <% total_price += cart_item.subtotal %><%# 合計金額に小計を加算 %>
        <% end %>
      </tbody>
    </table>

    <div class="row mt-4">
      <div class="col-md-4">
        <%= link_to '買い物を続ける', items_path, class: 'btn btn-primary' %>
      </div>
      <div class="col-md-4 offset-md-4">
        <table class="table table-bordered">
          <tr>
            <th class="table-active" style="width: 50%;">合計金額</th>
            <td>¥<%= total_price.to_s(:delimited) %></td>
          </tr>
        </table>
      </div>
    </div>
    <div class='col-md-2 mx-auto my-4'>
      <%= link_to '情報入力に進む', new_order_path, class: 'btn btn-success' %>
    </div>
  </div>
</div>
